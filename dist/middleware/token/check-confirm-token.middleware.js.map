{"version":3,"file":"check-confirm-token.middleware.js","sourceRoot":"","sources":["../../../src/middleware/token/check-confirm-token.middleware.ts"],"names":[],"mappings":";;;AACA,+CAAsE;AACtE,yCAA0D;AAC1D,uDAAuD;AACvD,2CAAkD;AAClD,6CAA6C;AAEtC,MAAM,2BAA2B,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;IAClH,IAAI;QACF,MAAM,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC;QAC/B,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,IAAI,CAAC,IAAI,qBAAY,CAAC,mCAAuB,CAAC,WAAW,EAAE,qBAAY,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;SAC/G;QACD,MAAM,IAAA,2BAAiB,EAAC,sBAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;QACzD,MAAM,WAAW,GAAG,MAAM,sBAAW,CAAC,qBAAqB,CAAC,sBAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;QAC7F,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC,IAAI,qBAAY,CAAC,mCAAuB,CAAC,SAAS,EAAE,qBAAY,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAClG;QACD,GAAG,CAAC,IAAI,GAAG,WAAW,CAAC;QAEvB,IAAI,EAAE,CAAC;KACR;IAAC,OAAO,CAAC,EAAE;QACV,IAAI,CAAC,CAAC,CAAC,CAAC;KACT;AACH,CAAC,CAAC;AAjBW,QAAA,2BAA2B,+BAiBtC","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { ActionEnum, ResponseStatusCodesEnum } from '../../constants';\r\nimport { customErrors, ErrorHandler } from '../../errors';\r\n// import { IRequestExtended } from '../../interfaces';\r\nimport { tokenVerification } from '../../helpers';\r\nimport { userService } from '../../services';\r\n\r\nexport const checkConfirmTokenMiddleware = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n  try {\r\n    const token = req.params.token;\r\n    if (!token) {\r\n      return next(new ErrorHandler(ResponseStatusCodesEnum.BAD_REQUEST, customErrors.BAD_REQUEST_NO_TOKEN.message));\r\n    }\r\n    await tokenVerification(ActionEnum.USER_REGISTER, token);\r\n    const userByToken = await userService.findUserByActionToken(ActionEnum.USER_REGISTER, token);\r\n    if (!userByToken) {\r\n      return next(new ErrorHandler(ResponseStatusCodesEnum.NOT_FOUND, customErrors.NOT_FOUND.message));\r\n    }\r\n    req.user = userByToken;\r\n\r\n    next();\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n"]}